datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

generator client {
    provider = "prisma-client-js"
}

enum EventType {
    crosspromo
    liveops
    app
    ads
}

enum MatchType {
    id
    class
}

model Project {
    id                    String   @id @default(uuid())
    name                  String
    apiKey                String   @unique
    updateIntervalSeconds Int
    events                Event[]
    createdAt             DateTime @default(now())
    updatedAt             DateTime @updatedAt

    @@index([apiKey])
}

model Event {
    id          String    @id @default(uuid())
    projectId   String
    project     Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)
    name        String
    description String?
    priority    Int
    type        EventType
    tags        Json
    createdAt   DateTime  @default(now())
    updatedAt   DateTime  @updatedAt
    logs        EventLog[]

    @@index([projectId])
    @@index([type])
}

model EventLog {
    id        String    @id @default(uuid())
    key       String
    timestamp BigInt
    url       String    @db.VarChar(2048)
    sessionId String    @db.Uuid
    eventId   String
    event     Event     @relation(fields: [eventId], references: [id], onDelete: Cascade)
    matchType MatchType

    @@index([eventId])
}
